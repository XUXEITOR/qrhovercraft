<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
  <title>Componente Naval del Comando Especial VRAEM - 2024 </title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.3.0/aframe.min.js"></script>
</head>
<body>
  <a-scene embedded>
    <a-camera position="0 0 0"></a-camera>
    <a-entity id="marker" position="0 0 0" visible="false">
      <a-image src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a8/QR_code_for_Wikipedia.svg/1200px-QR_code_for_Wikipedia.svg.png" width="1" height="1"></a-image>
    </a-entity>
    <a-entity id="model" visible="false">
      <a-video src="https://www.videezy.com/wp-content/uploads/2017/04/4K-Nature-Relax-Video-Footage.mp4" autoplay="true" loop="true" width="4" height="3"></a-video>
    </a-entity>
  </a-scene>
  <script>
    const marker = document.querySelector('#marker');
    const model = document.querySelector('#model');

    AFRAME.registerComponent('detect-marker', {
      init: function () {
        const sceneEl = this.el.sceneEl;
        const cameraEl = sceneEl.querySelector('a-camera');

        this.markerFound = false;

        sceneEl.addEventListener('markerFound', (event) => {
          if (event.detail.target === marker) {
            this.markerFound = true;
            model.setAttribute('visible', true);
          }
        });

        sceneEl.addEventListener('markerLost', (event) => {
          if (event.detail.target === marker) {
            this.markerFound = false;
            model.setAttribute('visible', false);
          }
        });

        this.tick = () => {
          if (this.markerFound) {
            const position = marker.getAttribute('position');
            model.setAttribute('position', position);
            
            // Sincronizar audio con video
            const videoEl = model.querySelector('a-video');
            const audioEl = document.createElement('audio');
            audioEl.src = videoEl.getAttribute('src');
            audioEl.play();
          }
        };

        sceneEl.tick(this.tick);
      }
    });

    marker.setAttribute('detect-marker', '');
  </script>
</body>
</html>
